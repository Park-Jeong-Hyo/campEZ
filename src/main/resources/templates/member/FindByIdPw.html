<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="" th:href="@{/css/member/FindByIdPw.css}"/>
  <title>$Title$</title>
  <script src="https://kit.fontawesome.com/4fab4e86c9.js" crossorigin="anonymous"></script>
      <script type="module" src="./common.js" th:src="@{/js/common.js}"></script>
</head>
<body>
<div class="wrapper">
  <div class="up-l"></div>

      <!-- 최상단 메뉴(UPPERMOST) -->
  <div class="up">
    <a href="" th:href="@{/}" class="up__link">HOME</a>
    <th:block th:if="${!session.isEmpty()}">
      <a href="" th:href="@{/mypage}" class="up__link">마이페이지</a>
      <a href="" th:href="@{/login/logout}" class="up__link">로그아웃</a>
    </th:block>
    <th:block th:if="${session.isEmpty()}">
      <a href="" th:href="@{/signup}" class="up__link">회원가입</a>
      <a href="" th:href="@{/login}" class="up__link">로그인</a>
    </th:block>
  </div>

  <div class="up-r"></div>

  <div class="hd-l"></div>

  <!-- 헤더 (HEADER) -->
  <header class="hd">
    <div class="hd__menu-item">
      <a href="" th:href="@{/search}" class="link">검색ez</a>
      <a href="" th:href="@{/preparing}" class="link">ez가이드</a>
      <a href="" th:href="@{/sitemap}" class="link">사이트맵</a>
    </div>
    <div class="hd__logo-item">
      <a href="" th:href="@{/}" class="link">
        <i class="hd__logo fa-solid fa-house"></i>
        <h2>캠핑EZ</h2>
      </a>
    </div>
    <div class="hd__empty-item"></div>
  </header>

  <div class="hd-r"></div>

  <div class="gnb-l"></div>

  <!-- gnb영역 -->
  <nav class="gnb">
    <div class="gnb__gwangjang-submenu">
      <div><a href="" th:href="@{/community/bulletinBoard}" class="gnb__depth link">자유게시판</a></div>
      <div><a href="" th:href="@{/community/question}" class="gnb__depth link">질문게시판</a></div>
    </div>
    <div><a href="" th:href="@{/search}" class="link">검색ez</a></div>
    <div><a href="" th:href="@{/preparing}" class="link">광장ez</a></div>
    <div><a href="" th:href="@{/preparing}" class="link">ez가이드</a></div>
  </nav>

  <div class="gnb-r"></div>

      <div class="mn-l"></div>

  <!-- 메인영역(MAIN) -->
  <main class="mn">
    <h2 class="head-line">아이디 / 비밀번호 찾기</h2>
    <hr class="line-hd" />
    <div class="tab-menu">
      <ul class="tab-nav">
        <li>
          <a href="#tab01"><button class="tab-btn1 btn-on">아이디 찾기</button></button></a>
        </li>
        <li>
          <a href="#tab02"><button class="tab-btn2 btn-off">비밀번호 찾기</button></button></a>
        </li>
      </ul>
    </div>
    <div class="tab on" id="tab01">
      <p style="height: 50px; margin-bottom: 20px">
        가입시 입력하신 정보로 아이디를 찾습니다.<br />
        입력정보가 기억나지 않는 경우 고객센터(Tel.0000-0000)로 문의해주시기
        바랍니다.
      </p>
      <form action="" class="log-box" id="idFrm" th:object="${findIdForm}">
        <div class="find-id">
          <div class="input-find">
            <div class="input-form">
              <label for="" class="input-label">이름</label>
              <input type="text" class="id-input" th:field="*{imname}"/>
            </div>
            <div class="input-form">
              <label for="" class="input-label">이메일</label>
              <input type="email" class="pw-input" th:field="*{iemail}" />
            </div>
            <div class="input-form">
              <label for="" class="input-label">휴대전화</label>
              <input type="text" class="pw-input" th:field="*{iphone}" />
            </div>
          </div>
        </div>
      </form>
      <button class="find-btn" type="button" id="btnFindId">아이디 찾기</button>
    </div>
    <div class="tab hidden" id="tab02">
      <p style="height: 50px; margin-bottom: 20px">
        가입시 입력하신 정보로 비밀번호를 찾습니다.<br>
        아이디가 기억나지 않는 경우 ‘아이디 찾기’를 먼저 진행해주시기 바랍니다.<br>
        입력정보가 기억나지 않는 경우 고객센터(Tel.0000-0000)로 문의해주시기 바랍니다.
      </p>
      <form action="" class="log-box" th:object="${findPwForm}">
        <div class="find-id">
          <div class="input-find">
            <div class="input-form">
              <label for="" class="input-label">아이디</label>
              <input type="text" class="id-input" th:field="*{pmid}"/>
            </div>
            <div class="input-form">
              <label for="" class="input-label">이메일</label>
              <input type="text" class="pw-input" th:field="*{pemail}" />
            </div>
            <div class="input-form">
              <label for="" class="input-label">휴대전화</label>
              <input type="text" class="pw-input" th:field="*{pphone}" />
            </div>
          </div>
        </div>
      </form>
      <button class="find-btn" id="btnFindPw">비밀번호 찾기</button>
    </div>
    <hr class="line-ft" />
  </main>

  <div class="mn-r"></div>

  <div class="ft-l"></div>

  <!-- 푸터영역(FOOTER)-->
  <footer class="ft">
    <div class="ft__logo-cell">
      <h2>캠핑EZ</h2>
    </div>
    <div class="ft__info-cell">
      <div class="ft__links">
        <a href="" class="link">개인정보취급방침</a>
        <a href="" class="link">홈페이지이용약관</a>
        <a href="" class="link">광고및제휴문의</a>
      </div>
      <div class="ft__others">
        <p>Copyrights(c) 2023 www.campingez.com. ALL RIGHTS RESERVED.</p>
        <p>TEL 010-1234-5678 (상담시간: 평일 10:00~18:00)</p>
        <p>E-MAIL : webmaster@testmail.com</p>
      </div>
    </div>
    <div class="ft__empty-cell"></div>
  </footer>
  <div class="ft-r"></div>
</div>
    <script type="module">
      import { ajax } from '/js/common.js';
      const $tabMenu = document.querySelector('.tab-menu');
      const $tapBtn1 = document.querySelector('.tab-btn1');
      const $tapBtn2 = document.querySelector('.tab-btn2');
      const $tab01 = document.getElementById('tab01');
      const $tab02 = document.getElementById('tab02');
            const $btnFindId = document.getElementById('btnFindId');
      const $btnFindPw = document.getElementById('btnFindPw');
      const $imname = document.getElementById('imname');
      const $iphone = document.getElementById('iphone');
      const $iemail = document.getElementById('iemail');
      const $pmid = document.getElementById('pmid');
      const $pemail = document.getElementById('pemail');
      const $pphone = document.getElementById('pphone');
      function tab_handler(e) {
        const v1 = e.target.textContent;
        if (v1 == '아이디 찾기') {
          $tab01.classList.remove('hidden');
          $tab02.classList.add('hidden');
          $tapBtn1.classList.add('btn-on');
          $tapBtn1.classList.remove('btn-off');
          $tapBtn2.classList.add('btn-off');
          $tapBtn2.classList.remove('btn-on');
        }
        if (v1 == '비밀번호 찾기') {
          $tab01.classList.add('hidden');
          $tab02.classList.remove('hidden');
          $tapBtn1.classList.add('btn-off');
          $tapBtn1.classList.remove('btn-on');
          $tapBtn2.classList.add('btn-on');
          $tapBtn2.classList.remove('btn-off');
        }
      }

 // 아이디 찾기
      const id_read = res => {
        console.log(res);
        if (res.header.rtcd == '00') {
          const data = res.data;
          console.log(data);
                    globalThis.location.href = `/members/findedid/${data}`;
        } else {
          throw new Error(`${res.header.rtmsg}`);
        }
      };
      const id_read_h = e => {
        const url = `http://localhost:9080/api/members/findid/${$imname.value}/${$iemail.value}/${$iphone.value}`;
        
        //유효성체크
        ajax
          .get(url)
          .then(res => res.json())
          .then(id_read) //.then(res => add(res))
      };

       // 비밀번호 찾기
      const pw_read = res => {
      console.log(res);
        if (res.header.rtcd == '00') {
          console.log(res);
          const data = res.data.mid;
          console.log(data);
                    globalThis.location.href = `/members/changepw/${data}`;
        } else {
          throw new Error(`${res.header.rtmsg}`);
        }
      };
      const pw_read_h = e => {
        const url = `http://localhost:9080/api/members/findpw/${$pmid.value}/${$pemail.value}/${$pphone.value}`;
        
        //유효성체크
        ajax
          .get(url)
          .then(res => res.json())
          .then(pw_read) //.then(res => add(res))
      };

      $tabMenu.addEventListener('click', tab_handler, false);
      $btnFindId.addEventListener('click', id_read_h, false);
      $btnFindPw.addEventListener('click', pw_read_h, false);
      
    </script>
</body>
</html>